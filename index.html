<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Nova Connect 4</title>
	<style>
		body {
			font-family: sans-serif;
			text-align: center;
			margin-top: 30px;
		}
		table {
			margin: 0 auto;
			border-spacing: 5px;
		}
		td {
			width: 50px;
			height: 50px;
			background-color: #ddd;
			border-radius: 50%;
			cursor: pointer;
		}
		.player1 {
			background-color: red;
		}
		.player2 {
			background-color: yellow;
		}
	</style>
</head>
<body>
	<h1>Connect 4: You (Red) vs Nova (Yellow)</h1>
	<h2 id="status"></h2>
	<table id="board"></table>

	<script>
	const ROWS = 6;
	const COLS = 7;
	const board = [];
	let gameOver = false;
	const status = document.getElementById('status');

	function createBoard() {
		const table = document.getElementById('board');
		table.innerHTML = '';
		for (let r = 0; r < ROWS; r++) {
			board[r] = [];
			const row = document.createElement('tr');
			for (let c = 0; c < COLS; c++) {
				board[r][c] = '';
				const cell = document.createElement('td');
				cell.dataset.row = r;
				cell.dataset.col = c;
				cell.onclick = () => handlePlayerMove(c);
				row.appendChild(cell);
			}
			table.appendChild(row);
		}
	}

	function handlePlayerMove(col) {
		if (gameOver) return;
		for (let r = ROWS - 1; r >= 0; r--) {
			if (board[r][col] === '') {
				board[r][col] = 'R';
				render();
				if (checkWin('R')) {
					status.textContent = 'You win!';
					gameOver = true;
					reportGameResult("Connect 4", "win");
					return;
				}
				if (isDraw()) {
					status.textContent = "It's a draw!";
					gameOver = true;
					reportGameResult("Connect 4", "draw");
					return;
				}
				setTimeout(novaMove, 300);
				return;
			}
		}
	}

	function novaMove() {
		// Simple AI: pick first available column
		for (let c = 0; c < COLS; c++) {
			for (let r = ROWS - 1; r >= 0; r--) {
				if (board[r][c] === '') {
					board[r][c] = 'Y';
					render();
					if (checkWin('Y')) {
						status.textContent = 'Nova wins!';
						gameOver = true;
						reportGameResult("Connect 4", "lose");
					} else if (isDraw()) {
						status.textContent = "It's a draw!";
						gameOver = true;
						reportGameResult("Connect 4", "draw");
					}
					return;
				}
			}
		}
	}

	function checkWin(player) {
		// Check horizontal, vertical, diagonal
		for (let r = 0; r < ROWS; r++) {
			for (let c = 0; c < COLS; c++) {
				if (
					c + 3 < COLS &&
					board[r][c] === player &&
					board[r][c + 1] === player &&
					board[r][c + 2] === player &&
					board[r][c + 3] === player
				) return true;
				if (
					r + 3 < ROWS &&
					board[r][c] === player &&
					board[r + 1][c] === player &&
					board[r + 2][c] === player &&
					board[r + 3][c] === player
				) return true;
				if (
					r + 3 < ROWS && c + 3 < COLS &&
					board[r][c] === player &&
					board[r + 1][c + 1] === player &&
					board[r + 2][c + 2] === player &&
					board[r + 3][c + 3] === player
				) return true;
				if (
					r - 3 >= 0 && c + 3 < COLS &&
					board[r][c] === player &&
					board[r - 1][c + 1] === player &&
					board[r - 2][c + 2] === player &&
					board[r - 3][c + 3] === player
				) return true;
			}
		}
		return false;
	}

	function isDraw() {
		return board[0].every(cell => cell !== '');
	}

	function render() {
		const table = document.getElementById('board');
		for (let r = 0; r < ROWS; r++) {
			for (let c = 0; c < COLS; c++) {
				const cell = table.rows[r].cells[c];
				cell.className = board[r][c] === 'R' ? 'player1' : board[r][c] === 'Y' ? 'player2' : '';
			}
		}
	}

	async function reportGameResult(gameName, outcome) {
		const params = new URLSearchParams(window.location.search);
		const userID = params.get("user");
		if (!userID) return;
		const content = `<@${userID}> finished ${gameName}: **${outcome.toUpperCase()}**`;
		await fetch("https://discord.com/api/webhooks/1370828516551295078/utPrT9ERPaCam4c_SCnTR3s7iEcyKpffUgW39Q7mdhhDFGbh7skS5kMiEnVSYtgZ1Jay", {
			method: "POST",
			headers: { "Content-Type": "application/json" },
			body: JSON.stringify({ content })
		});
	}

	createBoard();
	</script>
</body>
</html>